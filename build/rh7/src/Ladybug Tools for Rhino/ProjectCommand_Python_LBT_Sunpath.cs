using System;

using Rhino.Commands;

namespace RhinoCodePlatform.Rhino3D.Projects.Plugin
{
  [CommandStyle(Rhino.Commands.Style.ScriptRunner)]
  public class ProjectCommand_Python_LBT_Sunpath  : Command
  {
    Rhino.Runtime.PythonScript _script;
    Rhino.Runtime.PythonCompiledCode _compiledCode;

    public Guid CommandId { get; } = new Guid("0566725e-a8ae-4419-8d94-4d0c6910c256");

    public override string EnglishName => "LBT_Sunpath";

    protected override Rhino.Commands.Result RunCommand(Rhino.RhinoDoc doc, Rhino.Commands.RunMode mode)
    {
      if (_compiledCode is null)
      {
        ProjectLibs.InitPythonLibraries();

        _script = Rhino.Runtime.PythonScript.Create();
        _compiledCode = _script.Compile(
            ProjectPlugin.DecryptString("IyEgcHl0aG9uIDINCmltcG9ydCBvcw0KaW1wb3J0IG1hdGgNCg0KdHJ5Og0KICAgIGZyb20gbGFkeWJ1Z19nZW9tZXRyeS5nZW9tZXRyeTJkIGltcG9ydCBQb2ludDJEDQogICAgZnJvbSBsYWR5YnVnX2dlb21ldHJ5Lmdlb21ldHJ5M2QgaW1wb3J0IFBvaW50M0QsIFZlY3RvcjNEDQpleGNlcHQgSW1wb3J0RXJyb3IgYXMgZToNCiAgICByYWlzZSBJbXBvcnRFcnJvcignXG5GYWlsZWQgdG8gaW1wb3J0IGxhZHlidWdfZ2VvbWV0cnk6XG5cdHt9Jy5mb3JtYXQoZSkpDQoNCnRyeToNCiAgICBmcm9tIGxhZHlidWcuZnV0aWwgaW1wb3J0IHVuemlwX2ZpbGUNCiAgICBmcm9tIGxhZHlidWcuY29uZmlnIGltcG9ydCBmb2xkZXJzDQogICAgZnJvbSBsYWR5YnVnLmR0IGltcG9ydCBEYXRlVGltZQ0KICAgIGZyb20gbGFkeWJ1Zy5lcHcgaW1wb3J0IEVQVw0KICAgIGZyb20gbGFkeWJ1Zy5zdW5wYXRoIGltcG9ydCBTdW5wYXRoDQpleGNlcHQgSW1wb3J0RXJyb3IgYXMgZToNCiAgICByYWlzZSBJbXBvcnRFcnJvcignXG5GYWlsZWQgdG8gaW1wb3J0IGxhZHlidWc6XG5cdHt9Jy5mb3JtYXQoZSkpDQoNCnRyeToNCiAgICBmcm9tIGxhZHlidWdfcmhpbm8uZG93bmxvYWQgaW1wb3J0IGRvd25sb2FkX2ZpbGUNCiAgICBmcm9tIGxhZHlidWdfcmhpbm8uY29uZmlnIGltcG9ydCBjb252ZXJzaW9uX3RvX21ldGVycw0KICAgIGZyb20gbGFkeWJ1Z19yaGluby5wcmV2aWV3IGltcG9ydCBWaXN1YWxpemF0aW9uU2V0Q29uZHVpdA0KICAgIGZyb20gbGFkeWJ1Z19yaGluby50b2dlb21ldHJ5IGltcG9ydCB0b19wb2ludDNkDQogICAgZnJvbSBsYWR5YnVnX3JoaW5vLmZyb21nZW9tZXRyeSBpbXBvcnQgZnJvbV9wb2ludDNkDQogICAgZnJvbSBsYWR5YnVnX3JoaW5vLmJha2VvYmplY3RzIGltcG9ydCBiYWtlX3Zpc3VhbGl6YXRpb25fc2V0DQpleGNlcHQgSW1wb3J0RXJyb3IgYXMgZToNCiAgICByYWlzZSBJbXBvcnRFcnJvcignXG5GYWlsZWQgdG8gaW1wb3J0IGxhZHlidWdfcmhpbm86XG5cdHt9Jy5mb3JtYXQoZSkpDQoNCmltcG9ydCBSaGlubw0KaW1wb3J0IHNjcmlwdGNvbnRleHQgYXMgc2MNCg0KDQpkZWYgcnVuX3N1bnBhdGhfY29tbWFuZCgpOg0KICAgICMgZ2V0IHRoZSBFUFcgZnJvbSBjb21tYW5kIGxpbmUNCiAgICBnZXB3ID0gUmhpbm8uSW5wdXQuQ3VzdG9tLkdldFN0cmluZygpDQogICAgZ2Vwdy5TZXRDb21tYW5kUHJvbXB0KCdTZWxlY3QgYW4gRVBXIGZpbGUgcGF0aCBvciBVUkwnKQ0KICAgIGVwd19wYXRoID0gTm9uZQ0KICAgIGlmICdsYnRfZXB3JyBpbiBzYy5zdGlja3k6DQogICAgICAgIGVwd19wYXRoID0gc2Muc3RpY2t5WydsYnRfZXB3J10NCiAgICAgICAgZ2Vwdy5TZXREZWZhdWx0U3RyaW5nKGVwd19wYXRoKQ0KDQogICAgIyBhZGQgYWxsIG9mIHRoZSBvcHRpb25zIHRvIHRoZSBjb21tYW5kDQogICAgbm9ydGhfID0gc2Muc3RpY2t5WydsYnRfbm9ydGgnXSBpZiAnbGJ0X25vcnRoJyBpbiBzYy5zdGlja3kgZWxzZSAwDQogICAgbm9ydGhfb3B0aW9uID0gUmhpbm8uSW5wdXQuQ3VzdG9tLk9wdGlvbkRvdWJsZShub3J0aF8sIDAsIDM2MCkNCiAgICBnZXB3LkFkZE9wdGlvbkRvdWJsZSgnTm9ydGgnLCBub3J0aF9vcHRpb24pDQoNCiAgICBzY2FsZV8gPSBzYy5zdGlja3lbJ2xidF9zdW5wYXRoX3NjYWxlJ10gaWYgJ2xidF9zdW5wYXRoX3NjYWxlJyBpbiBzYy5zdGlja3kgZWxzZSAxDQogICAgc2NhbGVfb3B0aW9uID0gUmhpbm8uSW5wdXQuQ3VzdG9tLk9wdGlvbkRvdWJsZShzY2FsZV8sIFRydWUsIDApDQogICAgZ2Vwdy5BZGRPcHRpb25Eb3VibGUoJ1NjYWxlJywgc2NhbGVfb3B0aW9uKQ0KDQogICAgcHJvamVjdGlvbl9pXyA9IHNjLnN0aWNreVsnbGJ0X3N1bnBhdGhfcHJvamVjdGlvbiddIFwNCiAgICAgICAgaWYgJ2xidF9zdW5wYXRoX3Byb2plY3Rpb24nIGluIHNjLnN0aWNreSBlbHNlIDANCiAgICBwcm9qZWN0aW9ucyA9ICgnM0QnLCAnU3RlcmVvR3JhcGhpYycsICdPcnRob2dyYXBoaWMnKQ0KICAgIHByb2pfbGlzdCA9IGdlcHcuQWRkT3B0aW9uTGlzdCgnUHJvamVjdGlvbicsIHByb2plY3Rpb25zLCBwcm9qZWN0aW9uX2lfKQ0KDQogICAgc29sYXJfdGltZV8gPSBzYy5zdGlja3lbJ2xidF9zdW5wYXRoX3NvbGFyX3RpbWUnXSBcDQogICAgICAgIGlmICdsYnRfc3VucGF0aF9zb2xhcl90aW1lJyBpbiBzYy5zdGlja3kgZWxzZSBGYWxzZQ0KICAgIHNvbGFyX3RpbWVfb3B0aW9uID0gUmhpbm8uSW5wdXQuQ3VzdG9tLk9wdGlvblRvZ2dsZShzb2xhcl90aW1lXywgJ05vJywgJ1llcycpDQogICAgZ2Vwdy5BZGRPcHRpb25Ub2dnbGUoJ1NvbGFyVGltZScsIHNvbGFyX3RpbWVfb3B0aW9uKQ0KDQogICAgZXB3X2RhdGFfaV8gPSBzYy5zdGlja3lbJ2xidF9zdW5wYXRoX2RhdGEnXSBcDQogICAgICAgIGlmICdsYnRfc3VucGF0aF9kYXRhJyBpbiBzYy5zdGlja3kgZWxzZSAwDQogICAgZXB3X2RhdGFfc2V0cyA9ICgNCiAgICAgICAgJ05vbmUnLCAnZHJ5X2J1bGJfdGVtcGVyYXR1cmUnLCAnZGV3X3BvaW50X3RlbXBlcmF0dXJlJywgJ3JlbGF0aXZlX2h1bWlkaXR5JywNCiAgICAgICAgJ3dpbmRfc3BlZWQnLCAnd2luZF9kaXJlY3Rpb24nLCAnZGlyZWN0X25vcm1hbF9yYWRpYXRpb24nLA0KICAgICAgICAnZGlmZnVzZV9ob3Jpem9udGFsX3JhZGlhdGlvbicsICdnbG9iYWxfaG9yaXpvbnRhbF9yYWRpYXRpb24nDQogICAgKQ0KICAgIGVwd19kYXRhX2xpc3QgPSBnZXB3LkFkZE9wdGlvbkxpc3QoJ0RhdGEnLCBlcHdfZGF0YV9zZXRzLCBlcHdfZGF0YV9pXykNCg0KICAgICMgZ2V0IHRoZSB3ZWF0aGVyIGZpbGUgYW5kIGFsbCBvcHRpb25zDQogICAgd2hpbGUgVHJ1ZToNCiAgICAgICAgIyBUaGlzIHdpbGwgcHJvbXB0IHRoZSB1c2VyIHRvIGlucHV0IGFuIEVQVyBhbmQgdmlzdWFsaXphdGlvbiBvcHRpb25zDQogICAgICAgIGdldF9lcHcgPSBnZXB3LkdldCgpDQogICAgICAgIGlmIGdldF9lcHcgPT0gUmhpbm8uSW5wdXQuR2V0UmVzdWx0LlN0cmluZzoNCiAgICAgICAgICAgIGVwd19wYXRoID0gZ2Vwdy5TdHJpbmdSZXN1bHQoKQ0KICAgICAgICAgICAgbm9ydGhfID0gbm9ydGhfb3B0aW9uLkN1cnJlbnRWYWx1ZQ0KICAgICAgICAgICAgc2NhbGVfID0gc2NhbGVfb3B0aW9uLkN1cnJlbnRWYWx1ZQ0KICAgICAgICAgICAgc29sYXJfdGltZV8gPSBzb2xhcl90aW1lX29wdGlvbi5DdXJyZW50VmFsdWUNCiAgICAgICAgZWxpZiBnZXRfZXB3ID09IFJoaW5vLklucHV0LkdldFJlc3VsdC5PcHRpb246DQogICAgICAgICAgICBpZiBnZXB3Lk9wdGlvbkluZGV4KCkgPT0gcHJval9saXN0Og0KICAgICAgICAgICAgICAgIHByb2plY3Rpb25faV8gPSBnZXB3Lk9wdGlvbigpLkN1cnJlbnRMaXN0T3B0aW9uSW5kZXgNCiAgICAgICAgICAgIGlmIGdlcHcuT3B0aW9uSW5kZXgoKSA9PSBlcHdfZGF0YV9saXN0Og0KICAgICAgICAgICAgICAgIGVwd19kYXRhX2lfID0gZ2Vwdy5PcHRpb24oKS5DdXJyZW50TGlzdE9wdGlvbkluZGV4DQogICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICBicmVhaw0KDQogICAgIyBzYXZlIGFsbCBvZiB0aGUgb3B0aW9ucyB0byBzdGlja3kNCiAgICBzYy5zdGlja3lbJ2xidF9ub3J0aCddID0gbm9ydGhfDQogICAgc2Muc3RpY2t5WydsYnRfc3VucGF0aF9zY2FsZSddID0gc2NhbGVfDQogICAgc2Muc3RpY2t5WydsYnRfc3VucGF0aF9wcm9qZWN0aW9uJ10gPSBwcm9qZWN0aW9uX2lfDQogICAgc2Muc3RpY2t5WydsYnRfc3VucGF0aF9zb2xhcl90aW1lJ10gPSBzb2xhcl90aW1lXw0KICAgIHNjLnN0aWNreVsnbGJ0X3N1bnBhdGhfZGF0YSddID0gZXB3X2RhdGFfaV8NCg0KICAgICMgcHJvY2VzcyB0aGUgRVBXIGZpbGUgcGF0aCBvciBVUkwNCiAgICBpZiBub3QgZXB3X3BhdGg6DQogICAgICAgIHByaW50KCdObyBFUFcgZmlsZSBzZWxlY3RlZC4nKQ0KICAgICAgICByZXR1cm4NCiAgICBfZGVmX2ZvbGRlciA9IGZvbGRlcnMuZGVmYXVsdF9lcHdfZm9sZGVyDQogICAgaWYgZXB3X3BhdGguc3RhcnRzd2l0aCgnaHR0cCcpOiAgIyBkb3dubG9hZCB0aGUgRVBXIGZpbGUNCiAgICAgICAgX3dlYXRoZXJfVVJMID0gZXB3X3BhdGgNCiAgICAgICAgaWYgX3dlYXRoZXJfVVJMLmxvd2VyKCkuZW5kc3dpdGgoJy56aXAnKTogICMgb25lYnVpbGRpbmcgVVJMIHR5cGUNCiAgICAgICAgICAgIF9mb2xkZXJfbmFtZSA9IF93ZWF0aGVyX1VSTC5zcGxpdCgnLycpWy0xXVs6LTRdDQogICAgICAgIGVsc2U6ICAjIGRlcHQgb2YgZW5lcmd5IFVSTCB0eXBlDQogICAgICAgICAgICBfZm9sZGVyX25hbWUgPSBfd2VhdGhlcl9VUkwuc3BsaXQoJy8nKVstMl0NCiAgICAgICAgZXB3X3BhdGggPSBvcy5wYXRoLmpvaW4oX2RlZl9mb2xkZXIsIF9mb2xkZXJfbmFtZSwgX2ZvbGRlcl9uYW1lICsgJy5lcHcnKQ0KICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUoZXB3X3BhdGgpOg0KICAgICAgICAgICAgemlwX2ZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihfZGVmX2ZvbGRlciwgX2ZvbGRlcl9uYW1lLCBfZm9sZGVyX25hbWUgKyAnLnppcCcpDQogICAgICAgICAgICBkb3dubG9hZF9maWxlKF93ZWF0aGVyX1VSTCwgemlwX2ZpbGVfcGF0aCwgVHJ1ZSkNCiAgICAgICAgICAgIHVuemlwX2ZpbGUoemlwX2ZpbGVfcGF0aCkNCiAgICAgICAgc2Muc3RpY2t5WydsYnRfZXB3J10gPSBvcy5wYXRoLmJhc2VuYW1lKGVwd19wYXRoKQ0KICAgIGVsaWYgbm90IG9zLnBhdGguaXNmaWxlKGVwd19wYXRoKToNCiAgICAgICAgcG9zc2libGVfZmlsZSA9IG9zLnBhdGguYmFzZW5hbWUoZXB3X3BhdGgpWzotNF0gXA0KICAgICAgICAgICAgaWYgZXB3X3BhdGgubG93ZXIoKS5lbmRzd2l0aCgnLmVwdycpIGVsc2UgZXB3X3BhdGgNCiAgICAgICAgZXB3X3BhdGggPSBvcy5wYXRoLmpvaW4oX2RlZl9mb2xkZXIsIHBvc3NpYmxlX2ZpbGUsIHBvc3NpYmxlX2ZpbGUgKyAnLmVwdycpDQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShlcHdfcGF0aCk6DQogICAgICAgICAgICBwcmludCgnU2VsZWN0ZWQgRVBXIGZpbGUgYXQgZG9lcyBub3QgZXhpc3QgYXQ6IHt9Jy5mb3JtYXQoZXB3X3BhdGgpKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIHNjLnN0aWNreVsnbGJ0X2VwdyddID0gcG9zc2libGVfZmlsZSArICcuZXB3Jw0KICAgIGVsc2U6DQogICAgICAgIHNjLnN0aWNreVsnbGJ0X2VwdyddID0gZXB3X3BhdGgNCg0KICAgICMgcHJvY2VzcyBhbGwgb2YgdGhlIGdsb2JhbCBpbnB1dHMgZm9yIHRoZSBzdW5wYXRoDQogICAgY2VudGVyX3B0M2QgPSBzYy5zdGlja3lbJ2xidF9vcmlnaW4nXSBpZiAnbGJ0X29yaWdpbicgaW4gc2Muc3RpY2t5IGVsc2UgUG9pbnQzRCgpDQogICAgcmFkaXVzID0gKDEwMCAqIHNjYWxlXykgLyBjb252ZXJzaW9uX3RvX21ldGVycygpDQogICAgZGFpbHlfID0gRmFsc2UNCiAgICBwcm9qZWN0aW9uXyA9IHByb2plY3Rpb25zW3Byb2plY3Rpb25faV9dIGlmIHByb2plY3Rpb25faV8gIT0gMCBlbHNlIE5vbmUNCg0KICAgICMgZ2V0IHRoZSBsb2NhdGlvbiBmcm9tIHRoZSBFUFcNCiAgICBlcHdfb2JqID0gRVBXKGVwd19wYXRoKQ0KICAgIF9sb2NhdGlvbiA9IGVwd19vYmoubG9jYXRpb24NCg0KICAgICMgcHJvY2VzcyB0aGUgRVBXIGRhdGEgdG8gYmUgcGxvdHRlZCBvbiB0aGUgY2hhcnQgaWYgaXQgd2FzIHJlcXVlc3RlZA0KICAgIGhveXNfLCBkYXRhXyA9IFtdLCBbXQ0KICAgIGlmIGVwd19kYXRhX2lfICE9IDA6DQogICAgICAgIGRhdGFfLmFwcGVuZChnZXRhdHRyKGVwd19vYmosIGVwd19kYXRhX3NldHNbZXB3X2RhdGFfaV9dKSkNCiAgICAgICAgZm9yIG1vbnRoIGluIHJhbmdlKDEsIDEzKToNCiAgICAgICAgICAgIGZvciBkYXkgaW4gcmFuZ2UoMSwgMjksIDcpOg0KICAgICAgICAgICAgICAgIGZvciBob3VyIGluIHJhbmdlKDI0KToNCiAgICAgICAgICAgICAgICAgICAgaG95c18uYXBwZW5kKERhdGVUaW1lKG1vbnRoLCBkYXksIGhvdXIpLmhveSkNCg0KICAgICMgbWFrZSB0aGUgc3VucGF0aCB2aXN1YWxpemF0aW9uIHNldA0KICAgIHNwID0gU3VucGF0aC5mcm9tX2xvY2F0aW9uKF9sb2NhdGlvbiwgbm9ydGhfKQ0KICAgIHZpc19zZXRfYXJncyA9IFtob3lzXywgZGF0YV8sIE5vbmUsIHJhZGl1cywgY2VudGVyX3B0M2QsIHNvbGFyX3RpbWVfLCBkYWlseV8sIHByb2plY3Rpb25fXQ0KICAgIHZpc19zZXQgPSBzcC50b192aXNfc2V0KCp2aXNfc2V0X2FyZ3MpDQoNCiAgICAjIHByZXZpZXcgdGhlIHZpc3VhbGl6YXRpb24gc2V0IGFuZCBhc2sgaWYgdGhlIG9yaWdpbiBzaG91bGQgYmUgY2hhbmdlZA0KICAgIGNvbmR1aXQgPSBWaXN1YWxpemF0aW9uU2V0Q29uZHVpdCh2aXNfc2V0LCByZW5kZXJfM2RfbGVnZW5kPVRydWUsIHJlbmRlcl8yZF9sZWdlbmQ9RmFsc2UpDQogICAgY29uZHVpdC5FbmFibGVkID0gVHJ1ZQ0KICAgIHNjLmRvYy5WaWV3cy5SZWRyYXcoKQ0KICAgIGdwID0gUmhpbm8uSW5wdXQuQ3VzdG9tLkdldFBvaW50KCkNCiAgICBncC5TZXRDb21tYW5kUHJvbXB0KCdTZWxlY3QgYSBQb2ludCBmb3IgdGhlIG9yaWdpbiBvciBwcmVzcyBFTlRFUiB0byBrZWVwIHRoZSBjdXJyZW50IG9uZS4nKQ0KICAgIGdwLlNldERlZmF1bHRQb2ludChmcm9tX3BvaW50M2QoY2VudGVyX3B0M2QpKQ0KICAgIGdwLkdldCgpDQogICAgaWYgZ3AuQ29tbWFuZFJlc3VsdCgpID09IFJoaW5vLkNvbW1hbmRzLlJlc3VsdC5TdWNjZXNzOg0KICAgICAgICBwb2ludCA9IGdwLlBvaW50KCkNCiAgICAgICAgb3JpZ2luID0gdG9fcG9pbnQzZChwb2ludCkNCiAgICAgICAgdmlzX3NldF9hcmdzWzRdID0gb3JpZ2luDQogICAgICAgIHNjLnN0aWNreVsnbGJ0X29yaWdpbiddID0gb3JpZ2luDQogICAgICAgIHZpc19zZXQgPSBzcC50b192aXNfc2V0KCp2aXNfc2V0X2FyZ3MpDQogICAgICAgIGNvbmR1aXQuRW5hYmxlZCA9IEZhbHNlDQogICAgICAgIGNvbmR1aXQgPSBWaXN1YWxpemF0aW9uU2V0Q29uZHVpdCh2aXNfc2V0LCByZW5kZXJfM2RfbGVnZW5kPVRydWUsIHJlbmRlcl8yZF9sZWdlbmQ9RmFsc2UpDQogICAgICAgIGNvbmR1aXQuRW5hYmxlZCA9IFRydWUNCiAgICAgICAgc2MuZG9jLlZpZXdzLlJlZHJhdygpDQoNCiAgICAjIGZpbmFsbHksIGxldCBwZW9wbGUgZGVjaWRlIHdoYXQgdGhleSB3YW50IHRvIGRvIHdpdGggdGhlIHJlc3VsdA0KICAgIGdyZXMgPSBSaGluby5JbnB1dC5DdXN0b20uR2V0U3RyaW5nKCkNCiAgICBncmVzLlNldENvbW1hbmRQcm9tcHQoJ1dvdWxkIHlvdSBsaWtlIHRvIGFkZCB0aGUgU3VucGF0aCBHZW9tZXRyeSB0byB0aGUgRG9jdW1lbnQ/IEhpdCBFTlRFUiB3aGVuIGRvbmUuJykNCiAgICBncmVzLlNldERlZmF1bHRTdHJpbmcoJ0FkZD8nKQ0KICAgIGJha2VfcmVzdWx0ID0gRmFsc2UNCiAgICByZXN1bHRfb3B0aW9uID0gUmhpbm8uSW5wdXQuQ3VzdG9tLk9wdGlvblRvZ2dsZShGYWxzZSwgJ05vJywgJ1llcycpDQogICAgZ3Jlcy5BZGRPcHRpb25Ub2dnbGUoJ0FkZFRvRG9jJywgcmVzdWx0X29wdGlvbikNCiAgICB3aGlsZSBUcnVlOg0KICAgICAgICAjIFRoaXMgd2lsbCBwcm9tcHQgdGhlIHVzZXIgdG8gaW5wdXQgYW4gRVBXIGFuZCB2aXN1YWxpemF0aW9uIG9wdGlvbnMNCiAgICAgICAgZ2V0X3JlcyA9IGdyZXMuR2V0KCkNCiAgICAgICAgaWYgZ2V0X3JlcyA9PSBSaGluby5JbnB1dC5HZXRSZXN1bHQuU3RyaW5nOg0KICAgICAgICAgICAgYmFrZV9yZXN1bHQgPSByZXN1bHRfb3B0aW9uLkN1cnJlbnRWYWx1ZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgYnJlYWsNCiAgICBjb25kdWl0LkVuYWJsZWQgPSBGYWxzZQ0KICAgIHNjLmRvYy5WaWV3cy5SZWRyYXcoKQ0KDQogICAgIyBhZGQgdGhlIHZpc3VhbGl6YXRpb24gc2V0IHRvIHRoZSBkb2N1bWVudA0KICAgIGlmIGJha2VfcmVzdWx0Og0KICAgICAgICBiYWtlX3Zpc3VhbGl6YXRpb25fc2V0KHZpc19zZXQsIGJha2VfM2RfbGVnZW5kPVRydWUpDQoNCg0KcnVuX3N1bnBhdGhfY29tbWFuZCgpDQo=")
          );
      }

      if (_compiledCode is null)
      {
        Rhino.RhinoApp.WriteLine("The script code for {0} could not be retrieved or compiled.", EnglishName);
        return Rhino.Commands.Result.Failure;
      }

      _script.ScriptContextDoc = doc;
      _script.SetVariable("__name__", "__main__");

      _compiledCode.Execute(_script);

      return Rhino.Commands.Result.Success;
    }
  }
}
